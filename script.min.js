let container=document.getElementById("jsoneditor"),options={mode:"code",modes:["code","tree","form","text","view"],onError:function(e){alert(e.toString())},onChange:function(){updateTable()}},editor=new JSONEditor(container,options),hotContainer=document.getElementById("hot"),hot=new Handsontable(hotContainer,{data:[],rowHeaders:!0,colHeaders:!0,height:"auto",width:"100%",licenseKey:"non-commercial-and-evaluation",contextMenu:{items:{row_remove:{name:"删除行",callback:function(e,t){var o=hot.getSelected()||[];0<o.length&&removeRow(o[0][0])}},col_remove:{name:"删除列",callback:function(e,t){var o=hot.getSelected()||[];0<o.length&&removeCol(o[0][1])}}}}});function jsonToTableData(t){try{Array.isArray(t)||(t=[t]);let e=[...new Set(t.flatMap(Object.keys))];return{headers:e.map((e,t)=>String.fromCharCode(65+t)),data:[e,...t.map(t=>e.map(e=>{e=t[e];return"object"==typeof e?JSON.stringify(e):e}))]}}catch(e){return console.error("JSON转换失败:",e),{headers:[],data:[]}}}function tableToJsonData(){hot.getColHeader();var e=hot.getData();let t=e[0];return e.slice(1).map(o=>{let a={};return t.forEach((e,t)=>{try{a[e]=JSON.parse(o[t])}catch{a[e]=o[t]}}),a})}function updateTable(){try{var{headers:e,data:t}=jsonToTableData(editor.get());hot.updateSettings({colHeaders:e,data:t})}catch(e){}}function addRow(){var e=hot.getData(),e=(new Array(hot.countCols()).fill(""),hot.alter("insert_row",e.length,1),tableToJsonData());editor.set(e)}function addCol(){var e=hot.getColHeader(),t="列"+(e.length+1),e=(hot.alter("insert_col",e.length,1),hot.setDataAtCell(0,e.length,t),tableToJsonData());editor.set(e)}function removeRow(e){0<=e&&e<hot.countRows()&&(hot.alter("remove_row",e,1),e=tableToJsonData(),editor.set(e))}function removeCol(e){0<=e&&e<hot.countCols()&&(hot.alter("remove_col",e,1),e=tableToJsonData(),editor.set(e))}hot.addHook("afterChange",(e,t)=>{if("edit"===t)try{var o=tableToJsonData();editor.set(o)}catch(e){console.error("更新JSON失败:",e)}}),document.getElementById("addRow").addEventListener("click",addRow),document.getElementById("addCol").addEventListener("click",addCol),editor.set([{"姓名":"张三","年龄":25,"地址":"北京"},{"姓名":"李四","年龄":30,"地址":"上海"}]),updateTable();